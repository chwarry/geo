# 地质预报 - 地表信息选项卡（正确版本）

## ✅ 更新完成

地表信息选项卡已按照正确的设计稿实现，包含"其他地表信息"的5个文本描述字段。

## 📋 地表信息字段

### 标题：其他地表信息

包含以下5个文本描述字段，每个字段都是必填项，最大256字符：

| 序号 | 字段名称 | 字段类型 | 必填 | 字符限制 | 说明 |
|-----|---------|---------|-----|---------|------|
| 1 | **地层岩性描述** | TextArea | ✅ | 256 | 描述地层的岩石类型和性质 |
| 2 | **地表岩溶描述** | TextArea | ✅ | 256 | 描述地表岩溶发育情况 |
| 3 | **特殊地质产状描述** | TextArea | ✅ | 256 | 描述特殊地质结构产状 |
| 4 | **人为坑道描述** | TextArea | ✅ | 256 | 描述人为开挖的坑道情况 |
| 5 | **地质评定** | TextArea | ✅ | 256 | 对整体地质情况的评定 |

## 🎨 UI布局

```
┌─────────────────────────────────────────────────────────┐
│ 修改设计围岩                                             │
├─────────────────────────────────────────────────────────┤
│ [基本信息] [地表信息] [分段信息] [图片上传]              │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 其他地表信息                                             │
│ ─────────────────────────────────────────────────────── │
│                                                          │
│ [地层岩性描述: ▼]           [地表岩溶描述: ▼]            │
│ [                    ]       [                    ]      │
│ [  文字描述（必填）   ]       [  文字描述（必填）   ]      │
│ [                    ]       [                    ]      │
│                     8 / 256                     8 / 256  │
│                                                          │
│ [特殊地质产状描述: ▼]       [人为坑道描述: ▼]            │
│ [                    ]       [                    ]      │
│ [  文字描述（必填）   ]       [  文字描述（必填）   ]      │
│ [                    ]       [                    ]      │
│                     8 / 256                     8 / 256  │
│                                                          │
│ [地质评定: ▼]                                            │
│ [                                                  ]     │
│ [              文字描述（必填）                     ]     │
│ [                                                  ]     │
│                                             8 / 256      │
│                                                          │
│                                    [确定]  [取消]        │
└─────────────────────────────────────────────────────────┘
```

### 布局说明：
- **第一行**：地层岩性描述 | 地表岩溶描述（两列）
- **第二行**：特殊地质产状描述 | 人为坑道描述（两列）
- **第三行**：地质评定（整行）

## 🔧 字段详细说明

### 1. 地层岩性描述 (surfaceStratumDescription)
- **用途**: 描述该区域的地层结构和岩石类型
- **示例**: "该区域主要为石灰岩地层，局部夹杂泥岩薄层，岩层倾角约30°"
- **验证**: 必填，最多256个字符
- **字段名**: `surfaceStratumDescription`

### 2. 地表岩溶描述 (surfaceKarstDescription)
- **用途**: 描述地表岩溶（喀斯特）地貌发育情况
- **示例**: "地表岩溶发育，可见多处溶沟、溶槽，局部有落水洞分布"
- **验证**: 必填，最多256个字符
- **字段名**: `surfaceKarstDescription`

### 3. 特殊地质产状描述 (surfaceSpecialGeologyDescription)
- **用途**: 描述特殊的地质构造、断层、褶皱等
- **示例**: "发现一条走向NE-SW的逆断层，断层面倾角约60°，有破碎带发育"
- **验证**: 必填，最多256个字符
- **字段名**: `surfaceSpecialGeologyDescription`

### 4. 人为坑道描述 (surfaceTunnelDescription)
- **用途**: 描述人工开挖的坑道、废弃矿洞等
- **示例**: "发现旧矿洞3处，其中2处已坍塌，1处深度约20米，存在安全隐患"
- **验证**: 必填，最多256个字符
- **字段名**: `surfaceTunnelDescription`

### 5. 地质评定 (surfaceGeologyAssessment)
- **用途**: 对整体地质条件的综合评定
- **示例**: "综合评定：地质条件复杂，岩溶发育，建议加强超前预报，采取注浆加固措施"
- **验证**: 必填，最多256个字符
- **字段名**: `surfaceGeologyAssessment`

## 💾 数据结构

### 表单字段定义
```typescript
// 地表信息字段
{
  surfaceStratumDescription: string,        // 地层岩性描述
  surfaceKarstDescription: string,          // 地表岩溶描述
  surfaceSpecialGeologyDescription: string, // 特殊地质产状描述
  surfaceTunnelDescription: string,         // 人为坑道描述
  surfaceGeologyAssessment: string          // 地质评定
}
```

### 表单初始化
```typescript
editForm.setFieldsValue({
  // 基本信息
  rockGrade: 'IV',
  mileagePrefix: 'DK',
  // ...
  
  // 地表信息
  surfaceStratumDescription: '',
  surfaceKarstDescription: '',
  surfaceSpecialGeologyDescription: '',
  surfaceTunnelDescription: '',
  surfaceGeologyAssessment: ''
})
```

### 提交数据格式
```typescript
{
  id: "record-123",
  basicInfo: {
    rockGrade: "IV",
    mileagePrefix: "DK",
    startMileage: "DK713+485",
    length: -205.00,
    author: "一分部",
    modifyReason: "修改原因说明"
  },
  surfaceInfo: {
    stratumDescription: "该区域主要为石灰岩地层...",
    karstDescription: "地表岩溶发育，可见多处溶沟...",
    specialGeologyDescription: "发现一条走向NE-SW的逆断层...",
    tunnelDescription: "发现旧矿洞3处...",
    geologyAssessment: "综合评定：地质条件复杂..."
  }
}
```

## 🎯 Form Item 配置

每个字段都使用相同的配置模式：

```tsx
<Form.Item
  label="字段标签"
  field="字段名称"
  rules={[
    { required: true, message: '请输入XXX描述' },
    { maxLength: 256, message: '最多256个字符' }
  ]}
>
  <TextArea
    placeholder="文字描述（必填）"
    rows={4}
    maxLength={256}
    showWordLimit  // 显示字数统计
    style={{ resize: 'none' }}
  />
</Form.Item>
```

### 关键属性说明：
- `rows={4}`: 文本框显示4行
- `maxLength={256}`: 最大字符数限制
- `showWordLimit`: 显示字数统计（如：8 / 256）
- `resize: 'none'`: 禁止用户调整大小

## 🔄 表单验证规则

### 验证规则配置
```typescript
rules={[
  { required: true, message: '请输入XXX描述' },  // 必填验证
  { maxLength: 256, message: '最多256个字符' }   // 字符长度验证
]}
```

### 验证时机
1. **实时验证**: 用户输入时自动验证
2. **提交验证**: 点击"确定"时验证所有字段
3. **字符统计**: 实时显示已输入字符数

### 验证反馈
- ✅ **通过**: 无提示
- ❌ **失败**: 红色错误提示
- 📊 **字数**: 实时显示"已输入 / 最大限制"

## 🎨 UI特性

### 1. 标题分隔
```tsx
<div style={{ 
  fontSize: '14px', 
  color: '#1d2129', 
  fontWeight: 500,
  marginBottom: '20px',
  paddingBottom: '12px',
  borderBottom: '1px solid #e5e6eb'
}}>
  其他地表信息
</div>
```

### 2. 两列布局
- 第一行：地层岩性描述 | 地表岩溶描述
- 第二行：特殊地质产状描述 | 人为坑道描述
- 第三行：地质评定（独占一行）

### 3. 字数统计
- 右下角显示：`8 / 256`
- 自动更新，不需要额外代码

## 📊 与基本信息的区别

| 特性 | 基本信息 | 地表信息（新） |
|-----|---------|---------------|
| **字段类型** | 下拉、输入、数字 | 全部为文本域 |
| **字段数量** | 6个 | 5个 |
| **布局方式** | 混合布局 | 2-2-1布局 |
| **数据结构** | 结构化数据 | 描述性文本 |
| **用途** | 基础预报信息 | 地表地质详情 |
| **字符限制** | 无 | 每个256字符 |

## 🔌 API对接建议

### 提交接口
```
PUT /api/v1/geology-forecast/{id}
Content-Type: application/json

{
  "basicInfo": {
    "rockGrade": "IV",
    "mileagePrefix": "DK",
    "startMileage": "DK713+485",
    "length": -205.00,
    "author": "一分部",
    "modifyReason": "修改原因"
  },
  "surfaceInfo": {
    "stratumDescription": "该区域主要为石灰岩地层，局部夹杂泥岩薄层",
    "karstDescription": "地表岩溶发育，可见多处溶沟、溶槽",
    "specialGeologyDescription": "发现一条走向NE-SW的逆断层",
    "tunnelDescription": "发现旧矿洞3处，其中2处已坍塌",
    "geologyAssessment": "综合评定：地质条件复杂，建议加强超前预报"
  }
}
```

### 响应数据
```json
{
  "code": 200,
  "message": "修改成功",
  "data": {
    "id": "record-123",
    "basicInfo": { /* ... */ },
    "surfaceInfo": { /* ... */ }
  }
}
```

## ✅ 验证清单

- [x] 标题显示"其他地表信息"
- [x] 包含5个文本描述字段
- [x] 所有字段必填验证
- [x] 字符长度限制256
- [x] 显示字数统计
- [x] 2-2-1布局（两列-两列-单列）
- [x] 占位符显示"文字描述（必填）"
- [x] TextArea高度4行
- [x] 禁止调整大小
- [x] 表单验证正常
- [x] 提交数据格式正确
- [x] 无语法错误

## 🌟 功能亮点

### 1. 专业性
- 5个字段覆盖地质预报的关键地表要素
- 符合地质工程专业术语和流程

### 2. 易用性
- 大文本框，便于详细描述
- 实时字数统计，避免超限
- 必填提示清晰

### 3. 数据完整性
- 所有字段必填，确保数据完整
- 字符限制合理，既能详细描述又不过于冗长

### 4. 布局合理
- 相关字段分组（岩性和岩溶、产状和坑道）
- 地质评定独占一行，突出重要性

## 📝 使用场景示例

### 场景：隧道掘进前的地表勘察

1. **地层岩性描述**：
   ```
   该隧道段地表主要为三叠系灰岩，局部夹杂白云质灰岩薄层，
   岩层走向NE45°，倾向SE，倾角25-35°，岩层产状较平缓。
   ```

2. **地表岩溶描述**：
   ```
   地表岩溶中等发育，可见溶沟、溶槽分布，深度0.5-2米不等，
   局部发现3处落水洞，其中1处直径约5米，深度不详，雨季有水流声。
   ```

3. **特殊地质产状描述**：
   ```
   在DK713+200处发现一条逆断层，走向NE-SW，倾向SE，倾角约60°，
   破碎带宽度约2米，岩石破碎，充填泥质物，可能影响隧道施工。
   ```

4. **人为坑道描述**：
   ```
   地表调查发现旧煤矿巷道3条，均为20世纪70年代开挖，
   其中2条已完全坍塌，1条部分保留，洞口位于DK713+350，
   深度约30米，存在塌方风险。
   ```

5. **地质评定**：
   ```
   综合评定：该段地质条件较为复杂，岩溶中等发育，存在断层破碎带
   和旧矿洞，施工风险较高。建议：①加强超前地质预报；②采用TSP、
   地质雷达等综合探测手段；③对旧矿洞区域进行注浆加固处理。
   ```

## 🚀 后续优化建议

1. **图文结合**
   - 允许在描述中插入图片
   - 地质剖面图、现场照片等

2. **模板功能**
   - 提供常用描述模板
   - 快速填充常见地质情况

3. **智能提示**
   - 输入关键词时提供专业术语建议
   - 历史描述记录参考

4. **数据分析**
   - 基于描述内容自动提取关键信息
   - 风险等级自动评估

现在地表信息选项卡已完全符合设计要求！🎉

